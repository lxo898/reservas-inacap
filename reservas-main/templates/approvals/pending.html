{% extends "base.html" %}
{% block title %}Reservas Inacap ¬∑ Aprobaciones pendientes{% endblock %}
{% block content %}

<section class="p-4 rounded-4 mb-4 inacap-hero">
  <h1 class="h3 m-0">üìù Aprobaciones pendientes</h1>
  <div class="small text-white-50">Revisa y decide ¬∑ Reservas Inacap</div>
</section>

<div class="card shadow-sm border-0 rounded-4">
  <div class="card-body">
    {% if reservations %}
      <div class="row g-2 mb-3">
        <div class="col-md-6">
          <div class="input-group">
            <span class="input-group-text"><i class="bi bi-search"></i></span>
            <input id="filterInput" type="text" class="form-control" placeholder="Filtrar por usuario, espacio o motivo...">
          </div>
          <div class="form-text">Filtrado local (no afecta los datos en el servidor).</div>
        </div>
      </div>

      <div class="table-responsive">
        <table class="table table-hover align-middle" id="pendingTable">
          <thead class="table-light">
            <tr>
              <th>Usuario</th>
              <th>Espacio</th>
              <th>Inicio</th>
              <th>T√©rmino</th>
              <th>Motivo</th>
              <th class="text-end" style="width: 140px;">Acciones</th>
            </tr>
          </thead>
          <tbody>
            {% for r in reservations %}
            <tr>
              <td class="fw-semibold">{{ r.user.username }}</td>
              <td>{{ r.space }}</td>
              <td><small class="text-muted">{{ r.start|date:"Y-m-d H:i" }}</small></td>
              <td><small class="text-muted">{{ r.end|date:"Y-m-d H:i" }}</small></td>
              <td>{{ r.purpose|default:"‚Äî" }}</td>
              <td class="text-end">
                <a class="btn btn-sm btn-outline-primary" href="{% url 'approve_or_reject' r.id %}">
                  <i class="bi bi-pencil-square"></i> Revisar
                </a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <div class="text-center py-4">
        <div class="display-6 mb-2">‚úÖ</div>
        <p class="text-muted m-0">No hay solicitudes pendientes por ahora.</p>
      </div>
    {% endif %}
  </div>
</div>

{% block extra_js %}
<script>
  // Filtro local por texto en la tabla
  (function(){
    const input = document.getElementById('filterInput');
    const table = document.getElementById('pendingTable');
    if(!input || !table) return;

    input.addEventListener('input', function(){
      const q = this.value.toLowerCase();
      const rows = table.querySelectorAll('tbody tr');
      rows.forEach(tr => {
        const user = tr.children[0]?.innerText.toLowerCase() || '';
        const space = tr.children[1]?.innerText.toLowerCase() || '';
        const purpose = tr.children[4]?.innerText.toLowerCase() || '';
        tr.style.display = (user.includes(q) || space.includes(q) || purpose.includes(q)) ? '' : 'none';
      });
    });
  })();
</script>
{% endblock %}
{% endblock %}
