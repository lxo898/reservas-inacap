{% extends "base.html" %}
{% block title %}Reservas Inacap ¬∑ Recursos{% endblock %}
{% block content %}

<section class="p-4 rounded-4 mb-4 inacap-hero">
  <div class="d-flex justify-content-between align-items-center">
    <h1 class="h3 m-0">üß∞ Recursos ¬∑ Reservas Inacap</h1>
    {% if user.is_staff and not is_coordinator %}
    <a href="{% url 'resource_new' %}" class="btn btn-light text-danger rounded-3">
      <i class="bi bi-plus-circle"></i> Nuevo recurso
    </a>
    {% endif %}
  </div>
</section>

<div class="card shadow-sm border-0 rounded-4">
  <div class="card-body">
    {% if object_list %}
    <div class="row g-2 mb-3">
      <div class="col-md-6">
        <div class="input-group">
          <span class="input-group-text"><i class="bi bi-search"></i></span>
          <input id="tableFilter" type="text" class="form-control" placeholder="Buscar por nombre o espacio...">
        </div>
        <div class="form-text">Filtrado local, no afecta los datos en el servidor.</div>
      </div>
    </div>

    <div class="table-responsive">
      <table class="table table-hover align-middle" id="resourcesTable">
        <thead class="table-light">
          <tr>
            <th>Nombre</th>
            <th>Cantidad</th>
            <th>Espacio</th>
            {% if user.is_staff and not is_coordinator %}
            <th class="text-end" style="width: 200px;">Acciones</th>
            {% endif %}
          </tr>
        </thead>
        <tbody>
          {% for r in object_list %}
          <tr>
            <td class="fw-semibold">{{ r.name }}</td>
            <td>
              {% if r.quantity|default:0 <= 1 %} <span class="badge text-bg-warning">{{ r.quantity }}</span>
                {% else %}
                {{ r.quantity }}
                {% endif %}
            </td>
            <td>
              {% if r.space %}
              <span class="badge rounded-pill text-bg-secondary">{{ r.space }}</span>
              {% else %}
              <span class="text-muted">‚Äî</span>
              {% endif %}
            </td>

            {% if user.is_staff and not is_coordinator %}
            <td class="text-end">
              <div class="btn-group">
                <a class="btn btn-sm btn-outline-primary" href="{% url 'resource_edit' r.id %}">
                  <i class="bi bi-pencil-square"></i> Editar
                </a>
                <a class="btn btn-sm btn-outline-danger" href="{% url 'resource_delete' r.id %}">
                  <i class="bi bi-trash3"></i> Eliminar
                </a>
              </div>
            </td>
            {% endif %}
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <div class="text-center py-4">
      <div class="display-6 mb-2">üóÇÔ∏è</div>
      <p class="text-muted m-0">No hay recursos cargados.</p>
      {% if user.is_staff and not is_coordinator %}
      <div class="mt-3">
        <a href="{% url 'resource_new' %}" class="btn btn-danger rounded-3">
          <i class="bi bi-plus-circle"></i> Crear el primero
        </a>
      </div>
      {% endif %}
    </div>
    {% endif %}
  </div>
</div>

<script>
  (function () {
    const input = document.getElementById('tableFilter');
    const table = document.getElementById('resourcesTable');
    if (!input || !table) return;

    input.addEventListener('input', function () {
      const q = this.value.toLowerCase();
      const rows = table.querySelectorAll('tbody tr');
      rows.forEach(tr => {
        const name = tr.children[0]?.innerText.toLowerCase() || '';
        const space = tr.children[2]?.innerText.toLowerCase() || '';
        tr.style.display = (name.includes(q) || space.includes(q)) ? '' : 'none';
      });
    });
  })();
</script>
{% endblock %}