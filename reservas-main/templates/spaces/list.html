{% extends "base.html" %}
{% block title %}Reservas Inacap ¬∑ Espacios{% endblock %}
{% block content %}

<section class="p-4 rounded-4 mb-4 inacap-hero">
  <div class="d-flex justify-content-between align-items-center">
    <h1 class="h3 m-0">üè¢ Espacios ¬∑ Reservas Inacap</h1>
    {% if user.is_staff and not is_coordinator %}
    <a href="{% url 'space_new' %}" class="btn btn-light text-danger rounded-3">
      <i class="bi bi-plus-circle"></i> Nuevo espacio
    </a>
    {% endif %}
  </div>
</section>

<div class="card shadow-sm border-0 rounded-4">
  <div class="card-body">
    {% if object_list %}
    <div class="row g-2 mb-3">
      <div class="col-md-6">
        <div class="input-group">
          <span class="input-group-text"><i class="bi bi-search"></i></span>
          <input id="spaceFilter" type="text" class="form-control" placeholder="Buscar por nombre o ubicaci√≥n...">
        </div>
        <div class="form-text">Filtrado local, no afecta los datos en el servidor.</div>
      </div>
    </div>

    <div class="table-responsive">
      <table class="table table-hover align-middle" id="spacesTable">
        <thead class="table-light">
          <tr>
            <th>Nombre</th>
            <th>Ubicaci√≥n</th>
            <th>Capacidad</th>
            <th>Activo</th>
            {% if user.is_staff and not is_coordinator %}
            <th class="text-end" style="width: 200px;">Acciones</th>
            {% endif %}
          </tr>
        </thead>
        <tbody>
          {% for s in object_list %}
          <tr>
            <td class="fw-semibold">{{ s.name }}</td>
            <td>{{ s.location|default:"‚Äî" }}</td>
            <td>
              {% if s.capacity|default:0 == 0 %}
              <span class="badge text-bg-warning">{{ s.capacity }}</span>
              {% else %}
              {{ s.capacity }}
              {% endif %}
            </td>
            <td>
              {% if s.is_active %}
              <span class="badge rounded-pill text-bg-success">S√≠</span>
              {% else %}
              <span class="badge rounded-pill text-bg-secondary">No</span>
              {% endif %}
            </td>

            {% if user.is_staff and not is_coordinator %}
            <td class="text-end">
              <div class="btn-group">
                <a class="btn btn-sm btn-outline-primary" href="{% url 'space_edit' s.id %}">
                  <i class="bi bi-pencil-square"></i> Editar
                </a>
                <a class="btn btn-sm btn-outline-danger" href="{% url 'space_delete' s.id %}">
                  <i class="bi bi-trash3"></i> Eliminar
                </a>
              </div>
            </td>
            {% endif %}
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <div class="text-center py-4">
      <div class="display-6 mb-2">üèóÔ∏è</div>
      <p class="text-muted m-0">No hay espacios cargados.</p>
      {% if user.is_staff and not is_coordinator %}
      <div class="mt-3">
        <a href="{% url 'space_new' %}" class="btn btn-danger rounded-3">
          <i class="bi bi-plus-circle"></i> Crear el primero
        </a>
      </div>
      {% endif %}
    </div>
    {% endif %}
  </div>
</div>

<script>
  (function () {
    const input = document.getElementById('spaceFilter');
    const table = document.getElementById('spacesTable');
    if (!input || !table) return;

    input.addEventListener('input', function () {
      const q = this.value.toLowerCase();
      const rows = table.querySelectorAll('tbody tr');
      rows.forEach(tr => {
        const name = tr.children[0]?.innerText.toLowerCase() || '';
        const location = tr.children[1]?.innerText.toLowerCase() || '';
        tr.style.display = (name.includes(q) || location.includes(q)) ? '' : 'none';
      });
    });
  })();
</script>
{% endblock %}